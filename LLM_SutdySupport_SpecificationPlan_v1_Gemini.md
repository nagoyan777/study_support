# Role
あなたは、中学受験支援アプリを開発するプロジェクトのリード開発者です。最新の技術スタックとクラウドサービスに精通しており、特にモバイルアプリとスマートスピーカー連携システムの設計・開発を得意としています。

## Goal
これから、中学受験を控える子どもとその保護者のための家庭学習支援アプリ「中学受験サポーター（仮）」を開発します。このドキュUMENTは、そのアプリの全体像、要件、技術仕様を定義したものです。あなたには、この内容を理解し、具体的な実装計画の策定、データベース設計、API設計、そして実際のコード生成を主導してもらいます。

---

## 1. プロジェクト概要

### 1.1. 目的
- **家庭学習の効率化:** 紙媒体の問題集やプリントの管理をデジタル化し、学習の手間を削減する。
- **学習状況の可視化:** 子どもの解答データを蓄積・分析し、得意・不得意分野を明確にする。
- **学習習慣の形成:** クイズ形式の反復学習やスマートスピーカー連携により、楽しく学習を継続できる仕組みを提供する。
- **親子のコミュニケーション円滑化:** 保護者が子どもの学習状況を簡単に把握し、適切なサポートができるようにする。

### 1.2. ターゲットユーザー
- **子ども:** 中学受験を控える小学校高学年
- **保護者:** 子どもの学習管理・サポートを行いたい親

### 1.3. 主要機能
1.  **問題・解答のデジタル化:** スマートフォンのカメラで問題用紙や解答を撮影。**OCRでテキストを読み取ると同時に、図・表・グラフなどは画像としてそのまま取り込む。**
2.  **自動丸つけ:** 子どもがアプリ上で解答を入力すると、登録された正答と照合し、自動で丸つけを行う。
3.  **クイズ自動生成:** 登録した問題の中から、苦手な問題や特定の単元に絞って、暗記や計算問題のクイズを自動で作成する。
4.  **Amazon Echo Show連携:** 作成したクイズをEcho Show上で音声と画面を使って出題・解答できるようにする。**問題に含まれる図やグラフも画面に表示する。**

### 1.4. スコープ外（このアプリでやらないこと）
本アプリは、家庭内での学習支援に特化するため、以下の機能は開発の対象外とします。
- **AIによる問題の自動生成:** 登録された問題からクイズは作成しますが、AIがゼロから新しい問題文を創作する機能は含めません。
- **オンライン家庭教師との連携:** 外部の講師と接続する機能は持ちません。
- **他ユーザーとの対戦・ランキング機能:** ソーシャル要素は含めず、子どものペースで学習できる環境を重視します。
- **詳細な解説動画コンテンツの提供:** 解説は登録されたテキストや画像に限り、動画配信プラットフォームのような機能は開発しません。

---

## 2. システムアーキテクチャ

本プロジェクトでは、拡張性と開発効率を考慮し、**モバイルアプリ**と**Alexaスキル**を連携させる構成を採用します。

- **モバイルアプリ (iOS/Android):**
  - 保護者と子どもが主に使用するインターフェース。
  - 問題の登録、解答の入力、学習状況の確認など、コアとなる機能を提供する。
  - FlutterやReact Nativeなどのクロスプラットフォームでの開発を推奨。

- **バックエンド (クラウドサーバー):**
  - 全てのデータ（ユーザー情報、問題テキスト、**問題画像**、成績など）を管理する。
  - モバイルアプリとAlexaスキルの両方からのリクエストを処理するAPIを提供する。
  - AWS (Lambda, DynamoDB, **S3 for Image Storage**) や Google Cloud (Cloud Functions, Firestore, **Cloud Storage for Image Storage**) のサーバーレスアーキテクチャを推奨。

- **Alexaスキル:**
  - Amazon Echo Showで動作するアプリケーション。
  - バックエンドAPIを介してクイズデータを取得し、音声と画面でクイズを提供する。
  - **画面表示にはAPL (Alexa Presentation Language) を使用し、テキストと画像を組み合わせたリッチなレイアウトを実現する。**



---

## 3. 要件定義

### 3.1. 機能要件

#### 【ユーザー管理機能】
- 親アカウントと子アカウントを作成できる。
- 親アカウントは複数の子アカウントを管理できる。

#### 【問題データベース機能】
- **OCRと画像による登録:**
  - スマホのカメラで問題用紙を撮影する。
  - 撮影した画像から、問題文や選択肢をOCRでテキストデータとして読み取る。**図、表、グラフなどの部分は画像として切り出し、問題データと紐付けて保存する。**
  - 読み取り結果（テキスト）と切り出した画像は、アプリ上で手動修正・調整が可能。
- **手動登録:**
  - 問題文、選択肢、解答、解説などを手動で入力・編集できる。
  - デバイスのアルバムから図やグラフの画像をアップロードして問題に添付できる。
- **メタデータ付与:**
  - 登録した問題に「算数」「理科」などの**科目**、「平面図形」「水溶液」などの**単元**、「基礎」「応用」などの**難易度**タグを付与できる。

#### 【学習・解答機能】
- 問題を表示する際、**テキストと画像が適切なレイアウトで表示される。**
- 子どもは、登録された問題セットを選んで解答できる。
- 解答後、即座に自動で採点され、正誤と得点が表示される。
- 間違えた問題には自動で「要復習」フラグがつく。

#### 【クイズ生成機能】
- 条件（科目、単元、問題数、要復習フラグなど）を指定して、カスタムクイズを作成できる。
- 作成したクイズは「今日の図形問題」「理科の一問一答」のように名前をつけて保存できる。

#### 【分析・レポート機能】
- 科目別、単元別の正答率をグラフで可視化する。
- 子どもの学習時間や解いた問題数を記録し、ダッシュボードで確認できる。

#### 【Alexaスキル連携機能】
- モバイルアプリで作成したクイズを、Echo Showに話しかけて開始できる。
- **Echo Showの画面に、APLを用いて問題文（テキスト）と関連画像（図、グラフなど）を同時に表示する。**
- 子どもは音声で解答し、結果はモバイルアプリの成績データに自動で記録される。

### 3.2. 非機能要件
- **ユーザビリティ:** 子どもが一人でも操作できる、シンプルで直感的なUIデザインとする。
- **OCR精度:** 高い精度で文字を認識できるOCRエンジンを選定する。
- **パフォーマンス:** 画像を含む問題データも、ストレスなく高速に表示されること。
- **セキュリティ:** ユーザーデータ、特に個人情報は適切に暗号化し、安全に管理すること。

---

## 4. 開発タスク（LLMへの指示）

### Task 1: データベース設計
上記の要件を満たすためのデータベーススキーマを設計してください。**特に、問題に複数の画像を含めることができるような設計**を考慮してください。
- `users` (ユーザー情報)
- `problems` (問題データ: **テキスト情報と画像情報への参照をどう持つか？**)
- `images` (画像データ: URLやメタデータ)
- `problem_sets` (問題の集まり)
- `answers` (子どもの解答履歴)
- `quizzes` (カスタムクイズ)
- `tags` (科目や単元のタグ)

**出力形式:** SQLのCREATE TABLE文、またはそれに準ずるプレーンテキスト形式で、テーブル間のリレーションシップも明記してください。

### Task 2: API設計
モバイルアプリおよびAlexaスキルがバックエンドと通信するためのRESTful APIのエンドポイントを設計してください。
- **問題登録用のエンドポイントでは、テキストデータと画像ファイル（multipart/form-data）を同時に受け取れるように設計してください。**
- 問題取得用のエンドポイントでは、テキスト情報と関連する画像のURLリストをレスポンスに含めてください。
- ユーザー認証、解答送信、クイズ生成、学習結果取得のエンドポイントも定義してください。

**出力形式:**
- HTTPメソッド + エンドポイントURL (例: `POST /api/problems`)
- 簡単なリクエストボディとレスポンスボディのJSON構造の例

### Task 3: モバイルアプリの画面構成
FlutterまたはReact Nativeで実装することを想定し、必要な画面とその画面に含まれる主要なUIコンポーネントをリストアップしてください。
- **問題表示画面:**
  - 問題文を表示するテキストエリア
  - **問題に関連する画像を表示するイメージビューア（複数画像に対応）**
  - 解答入力欄（選択式または記述式）
- **問題登録・編集画面:**
  - カメラ起動/アルバム選択ボタン
  - 撮影/選択した画像のプレビュー
  - **画像内の特定領域を「画像として切り出す」ためのトリミング・編集UI**
  - OCR結果のテキスト編集フォーム

### Task 4: Alexaスキル開発の主要ロジック
Alexa Skills Kit (ASK) for Node.js または Pythonで開発することを想定し、クイズ出題時の処理ロジックを疑似コードまたは箇条書きで記述してください。
- `StartQuizIntent` ハンドラ:
  1. バックエンドAPIを叩いて、指定されたクイズの問題リスト（テキストと画像URLを含む）を取得する。
  2. セッション情報に問題リストと現在の問題番号（例: 0）を保存する。
  3. 最初の問題データを使って、**テキストと画像をレイアウトしたAPLドキュメントを生成する。**
  4. `Alexa.Presentation.APL.RenderDocument` ディレクティブを含んだ応答を返し、画面に問題を表示させると同時に、問題を読み上げる。
- `AnswerIntent` ハンドラ:
  1. ユーザーの答えとセッションに保存された正答を比較し、正誤を判定する。
  2. 次の問題に進むか、クイズを終了するかを判断する。
  3. 次の問題に進む場合は、上記3, 4の処理を繰り返す。

---

このドキュメントを基に、段階的に開発を進めていきましょう。まずは `Task 1: データベース設計` から着手してください。準備ができたら、設計案を提示してください。